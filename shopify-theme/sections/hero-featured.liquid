{% schema %}
{
  "name": "Hero Featured Itineraries",
  "settings": [
    {
      "type": "text",
      "id": "label",
      "label": "Label",
      "default": "Our Top Itineraries"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Itineraries Collection",
      "info": "Select the collection containing your itineraries"
    },
    {
      "type": "color",
      "id": "placeholder_background_color",
      "label": "Placeholder Background Color",
      "default": "#f8d4ce"
    }
  ]
}
{% endschema %}

{%- liquid
  assign placeholder_bg = section.settings.placeholder_background_color | default: settings.color_pink | default: '#f8d4ce'
-%}

<section class="py-6 px-6">
  <p class="text-xs uppercase tracking-wider text-gray mb-4">
    {{ section.settings.label }}
  </p>
  
  {%- if section.settings.collection != blank and collections[section.settings.collection].products.size > 0 -%}
    <div class="hero-carousel-wrapper">
      {%- comment -%} Previous Arrow {%- endcomment -%}
      <button class="carousel-arrow carousel-arrow-prev" aria-label="Previous">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>

      <div class="hero-carousel flex gap-6 overflow-x-auto pb-4 snap-x snap-mandatory scroll-smooth">
        {%- for product in collections[section.settings.collection].products -%}
          <div class="hero-card flex-shrink-0 w-full md:w-1/2 lg:w-1/3 snap-start">
            <a href="{{ product.url }}" class="block group">
              <div class="grid md:grid-cols-2 gap-8 items-center">
                {%- if product.featured_image != blank -%}
                  <div class="relative aspect-4-3 overflow-hidden" style="background-color: {{ placeholder_bg }};">
                    {{
                      product.featured_image
                      | image_url: width: 800
                      | image_tag: loading: 'lazy', alt: product.title, class: 'object-cover transition-transform duration-300 group-hover:scale-105'
                    }}
                  </div>
                {%- else -%}
                  <div class="relative aspect-4-3 overflow-hidden" style="background-color: {{ placeholder_bg }};"></div>
                {%- endif -%}
                <div class="max-w-md">
                  <h2 class="text-3xl md:text-4xl lg:text-5xl mb-4 group-hover:opacity-70 transition-opacity">
                    {{ product.title | newline_to_br }}
                  </h2>
                  {%- if product.type != blank -%}
                    <p class="text-lg italic mb-2">{{ product.type }}</p>
                  {%- endif -%}
                  {%- if product.description != blank -%}
                    <p class="text-gray mb-4 line-clamp-3">
                      {{ product.description | strip_html | truncatewords: 30 }}
                    </p>
                  {%- endif -%}
                  <span class="read-more">Read Itinerary</span>
                </div>
              </div>
            </a>
          </div>
        {%- endfor -%}
      </div>

      {%- comment -%} Next Arrow {%- endcomment -%}
      <button class="carousel-arrow carousel-arrow-next" aria-label="Next">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>

      {%- comment -%} Scrollbar {%- endcomment -%}
      <div class="carousel-scrollbar">
        <div class="carousel-scrollbar-track">
          <div class="carousel-scrollbar-thumb"></div>
        </div>
      </div>
    </div>
  {%- else -%}
    <div class="text-center py-12">
      <p class="text-gray">No itineraries found. Please select a collection in the theme editor.</p>
    </div>
  {%- endif -%}
</section>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .scroll-smooth {
    scroll-behavior: smooth;
  }

  /* Hide native scrollbar */
  .hero-carousel {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .hero-carousel::-webkit-scrollbar {
    display: none;
  }

  /* Carousel wrapper with arrows */
  .hero-carousel-wrapper {
    position: relative;
  }

  /* Navigation Arrows */
  .hero-carousel-wrapper .carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-100%);
    width: 48px;
    height: 48px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .hero-carousel-wrapper .carousel-arrow:hover {
    background: #f9fafb;
    border-color: #d1d5db;
  }

  .hero-carousel-wrapper .carousel-arrow:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .hero-carousel-wrapper .carousel-arrow-prev {
    left: -24px;
  }

  .hero-carousel-wrapper .carousel-arrow-next {
    right: -24px;
  }

  @media (max-width: 768px) {
    .hero-carousel-wrapper .carousel-arrow {
      width: 40px;
      height: 40px;
    }

    .hero-carousel-wrapper .carousel-arrow-prev {
      left: -12px;
    }

    .hero-carousel-wrapper .carousel-arrow-next {
      right: -12px;
    }
  }

  /* Scrollbar */
  .hero-carousel-wrapper .carousel-scrollbar {
    margin-top: 1.5rem;
    padding: 0 48px;
  }

  .hero-carousel-wrapper .carousel-scrollbar-track {
    height: 2px;
    background: #e5e7eb;
    border-radius: 1px;
    position: relative;
  }

  .hero-carousel-wrapper .carousel-scrollbar-thumb {
    height: 100%;
    background: #1f2937;
    border-radius: 1px;
    position: absolute;
    left: 0;
    top: 0;
    min-width: 40px;
    transition: width 0.1s ease, left 0.1s ease;
  }
</style>

<script>
  (function() {
    const container = document.querySelector('.hero-carousel-wrapper');
    if (!container) return;
    
    const carousel = container.querySelector('.hero-carousel');
    const prevBtn = container.querySelector('.carousel-arrow-prev');
    const nextBtn = container.querySelector('.carousel-arrow-next');
    const thumb = container.querySelector('.carousel-scrollbar-thumb');
    
    if (!carousel || !prevBtn || !nextBtn || !thumb) return;
    
    const cardWidth = carousel.querySelector('.hero-card')?.offsetWidth || 400;
    const gap = 24;
    const scrollAmount = cardWidth + gap;
    
    function updateScrollbar() {
      const scrollLeft = carousel.scrollLeft;
      const scrollWidth = carousel.scrollWidth - carousel.clientWidth;
      const thumbWidth = Math.max((carousel.clientWidth / carousel.scrollWidth) * 100, 10);
      const thumbPosition = scrollWidth > 0 ? (scrollLeft / scrollWidth) * (100 - thumbWidth) : 0;
      
      thumb.style.width = thumbWidth + '%';
      thumb.style.left = thumbPosition + '%';
      
      prevBtn.disabled = scrollLeft <= 0;
      nextBtn.disabled = scrollLeft >= scrollWidth - 1;
    }
    
    prevBtn.addEventListener('click', () => {
      carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
    });
    
    nextBtn.addEventListener('click', () => {
      carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
    });
    
    carousel.addEventListener('scroll', updateScrollbar);
    window.addEventListener('resize', updateScrollbar);
    
    updateScrollbar();
  })();
</script>
