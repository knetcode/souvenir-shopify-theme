{% schema %}
{
  "name": "Product Main",
  "settings": {}
}
{% endschema %}

<div class="py-8 px-6">
  <div class="container">
    {%- comment -%} Breadcrumb {%- endcomment -%}
    <div class="flex items-center gap-2 text-xs uppercase tracking-wider text-gray mb-2">
      <a href="{{ routes.collections_url }}" class="hover:opacity-70">The Souvenir</a>
      <span>/</span>
      <span>{{ product.vendor | default: 'Shop by item' }}</span>
    </div>
    {%- if product.type != blank -%}
      <p class="text-gray mb-8">{{ product.type }}</p>
    {%- endif -%}

    {%- comment -%} Product Section {%- endcomment -%}
    <div class="grid md:grid-cols-2 gap-12 mb-16">
      {%- comment -%} Product Images {%- endcomment -%}
      <div>
        {%- if product.featured_image != blank -%}
          <div class="relative aspect-square overflow-hidden mb-4">
            {{
              product.featured_image
              | image_url: width: 600
              | image_tag: loading: 'eager', alt: product.title, class: 'object-cover', id: 'product-image-main'
            }}
          </div>
        {%- endif -%}
        
        {%- if product.images.size > 1 -%}
          <div class="flex gap-2">
            {%- for image in product.images limit: 5 -%}
              <button
                class="relative w-16 h-16 overflow-hidden border-2 border-transparent hover:border-foreground product-thumbnail"
                data-image-url="{{ image | image_url: width: 600 }}"
              >
                {{
                  image
                  | image_url: width: 100
                  | image_tag: loading: 'lazy', alt: product.title, class: 'object-cover'
                }}
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>

      {%- comment -%} Product Info {%- endcomment -%}
      <div>
        <h1 class="text-3xl md:text-4xl mb-2">{{ product.title }}</h1>
        {%- if product.vendor != blank -%}
          <p class="text-gray uppercase tracking-wide text-sm mb-4">
            {{ product.vendor }}
          </p>
        {%- endif -%}
        <p class="text-2xl mb-6">{{ product.price | money }}</p>

        {% form 'product', product, id: 'product-form' %}
          {%- comment -%} Variants {%- endcomment -%}
          {%- unless product.has_only_default_variant -%}
            {%- for option in product.options_with_values -%}
              <div class="mb-6">
                <p class="text-sm uppercase tracking-wide mb-3">{{ option.name }}</p>
                <div class="flex gap-3">
                  {%- for value in option.values -%}
                    <input
                      type="radio"
                      id="option-{{ option.position }}-{{ forloop.index0 }}"
                      name="options[{{ option.name }}]"
                      value="{{ value }}"
                      {% if option.selected_value == value %}checked{% endif %}
                      class="variant-option"
                    >
                    <label
                      for="option-{{ option.position }}-{{ forloop.index0 }}"
                      class="variant-label"
                    >
                      {{ value }}
                    </label>
                  {%- endfor -%}
                </div>
              </div>
            {%- endfor -%}
          {%- endunless -%}

          {%- comment -%} Quantity {%- endcomment -%}
          <div class="mb-6">
            <p class="text-sm uppercase tracking-wide mb-3">Qty</p>
            <div class="flex items-center gap-4">
              <button
                type="button"
                class="w-8 h-8 border border-gray-300 flex items-center justify-center hover:border-foreground quantity-decrease"
              >
                -
              </button>
              <input
                type="number"
                name="quantity"
                value="1"
                min="1"
                class="quantity-input text-center w-12"
                id="quantity"
              >
              <button
                type="button"
                class="w-8 h-8 border border-gray-300 flex items-center justify-center hover:border-foreground quantity-increase"
              >
                +
              </button>
            </div>
          </div>

          {%- comment -%} Add to Cart {%- endcomment -%}
          <button
            type="submit"
            class="w-full bg-foreground text-white py-4 text-sm uppercase tracking-wide hover:bg-transparent hover:text-foreground border border-foreground transition-colors mb-8"
          >
            Add to Cart
          </button>
        {% endform %}

        {%- comment -%} Product Description {%- endcomment -%}
        {%- if product.description != blank -%}
          <div class="text-gray space-y-4">
            {{ product.description }}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const thumbnails = document.querySelectorAll('.product-thumbnail');
    const mainImage = document.getElementById('product-image-main');
    
    thumbnails.forEach(thumb => {
      thumb.addEventListener('click', function() {
        const imageUrl = this.getAttribute('data-image-url');
        if (mainImage && imageUrl) {
          mainImage.src = imageUrl;
        }
      });
    });

    const quantityInput = document.getElementById('quantity');
    const decreaseBtn = document.querySelector('.quantity-decrease');
    const increaseBtn = document.querySelector('.quantity-increase');

    if (decreaseBtn && quantityInput) {
      decreaseBtn.addEventListener('click', function() {
        const current = parseInt(quantityInput.value) || 1;
        quantityInput.value = Math.max(1, current - 1);
      });
    }

    if (increaseBtn && quantityInput) {
      increaseBtn.addEventListener('click', function() {
        const current = parseInt(quantityInput.value) || 1;
        quantityInput.value = current + 1;
      });
    }
  });
</script>

<style>
  .variant-option {
    display: none;
  }
  
  .variant-label {
    display: inline-block;
    padding: 0.5rem 1rem;
    border: 1px solid #e5e7eb;
    cursor: pointer;
    transition: border-color 0.2s;
  }
  
  .variant-option:checked + .variant-label,
  .variant-label:hover {
    border-color: var(--foreground);
  }
  
  .w-full {
    width: 100%;
  }
  
  .w-12 {
    width: 3rem;
  }
  
  .h-8 {
    height: 2rem;
  }
</style>
